#!/bin/bash

BASE="$HOME/Projects/Octoblu"
NANOCYTE_FLOW_DEPLOY="$BASE/nanocyte-flow-deploy-service"
NANOCYTE_ENGINE_SIMPLE="$BASE/nanocyte-engine-simple"
NANOCYTE_INTERVAL_SERVICE="$BASE/nanocyte-interval-service"
NANOCYTE_INTERVAL_REDIS="$BASE/nanocyte-interval-redis"

SESSION='muxnanocyte'
cd $BASE

export MESHBLU_SERVER=localhost
export MESHBLU_PORT=3000
export NANOCYTE_SERVER=localhost

export OCTOBLU_SERVER=localhost
export OCTOBLU_PORT=8080
export NANOCYTE_PORT=5051
# NANOCYTE_INTERVAL_UUID


tmux start-server
tmux new-session -d -s $SESSION -n √ø
tmux send-keys -t $SESSION:0.0 "tmux kill-session -t $SESSION"

tmux new-window -t $SESSION:1 -n engine
tmux new-window -t $SESSION:2 -n interval
tmux new-window -t $SESSION:3 -n flow-deploy

tmux split-window -t $SESSION:1 -d -p 20

tmux split-window -t $SESSION:2 -d -p 20
tmux split-window -t $SESSION:2 -d -p 20

tmux split-window -t $SESSION:3 -d -p 20

tmux send-keys -t $SESSION:1.0 "cd $NANOCYTE_ENGINE_SIMPLE" C-m
tmux send-keys -t $SESSION:1.1 "cd $NANOCYTE_ENGINE_SIMPLE; npm install; PORT=5050 npm start" C-m

tmux send-keys -t $SESSION:2.0 "cd $NANOCYTE_INTERVAL_SERVICE" C-m
tmux send-keys -t $SESSION:2.1 "cd $NANOCYTE_INTERVAL_SERVICE; npm install; PORT=7071 npm start" C-m
tmux send-keys -t $SESSION:2.2 "cd $NANOCYTE_INTERVAL_REDIS; npm install; PORT=5555 npm start" C-m

# tmux send-keys -t $SESSION:2.0 "cd $OCTOBLU_DIR" C-m
# tmux send-keys -t $SESSION:2.1 "cd $OCTOBLU_DIR; npm install; gulp watch" C-m
# tmux send-keys -t $SESSION:2.2 "cd $OCTOBLU_FRONTEND_DIR; npm install; gulp watch" C-m
#
# tmux send-keys -t $SESSION:3.0 "cd $COREOS_VAGRANT; vagrant up && $FLOW_DEPLOY_DIR/bootstrap/development.sh" C-m
# tmux send-keys -t $SESSION:3.1 "cd $FLOW_DEPLOY_DIR; npm install; nodemon -e 'coffee js' server.coffee" C-m

tmux select-window -t $SESSION:1
tmux attach-session -t $SESSION
